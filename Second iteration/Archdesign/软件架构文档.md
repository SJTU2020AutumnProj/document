# 软件架构文档

- 项目名称：小箱交云作业平台
- 组号：第三组
- 编写日期：2020/11/8
- 版本：2.0



## 2. 用例视图

<img src="软件架构文档.assets/use_case.png" alt="use_case" style="zoom:67%;" />

<center>图 2.1 用例视图</center>



## 3. 逻辑视图

### 3.1 概述

​		系统采用B/S架构，可以分解为客户端、服务端与中间件。其中客户端可以进一步分解为接口层、组件层、视图层与路由层。接口层即service包，组件层即component包，视图层即view包，路由层即router包；服务端可以分为接口层与服务层，接口层即api包，服务层即service包；中间件为Middleware包，包括系统开发所使用的React框架、Gin框架、Go-Micro框架以及Go语言提供的MySQL数据库驱动。

<img src="软件架构文档.assets/logical_view.png" alt="logical_view" style="zoom:67%;" />

<center>图 3.1.1 总体逻辑视图</center>

<img src="软件架构文档.assets/browser.png" alt="browser" style="zoom:67%;" />

<center>图3.1.2 Browser端逻辑视图</center>

<img src="软件架构文档.assets/server.png" alt="server" style="zoom:67%;" />

<center>图3.1.3 Server端逻辑视图</center>



### 3.2 在构架方面具有重要意义的设计包

#### 3.2.1 总体逻辑视图

- Middleware：包括系统开发所使用的React框架、Gin框架、Go-Micro框架以及Go语言提供的MySQL数据库驱动
- Server：系统的服务端，负责解析客户端发送的请求并调用相应的服务
- Browser：系统的客户端，负责与客户交互并将请求发送给服务端

#### 3.2.2 客户端逻辑视图

- Service：负责将客户端页面的请求包装成Ajax请求发送给服务端
- Components：负责将从服务端收到的数据进行第一次组装，使其模块化
- View：负责将Components提供的模块组装成页面提供给用户浏览
- Router：提供路由功能，解析用户输入的URL并显示相应的页面
- Utils：由常用工具类组成

#### 3.2.3 服务端逻辑视图

- API：负责拦截客户端发送的请求、解析并分发给不同的服务进行处理
- Service：实现客户端的业务逻辑



## 4. 进程视图



<img src="软件架构文档.assets/process_view.png" alt="process_view" style="zoom:67%;" />
<center>图4.1 进程视图</center>

​		

​		如图所示，用户管理进程负责处理登录和注册的功能，用户的登录和注册请求通过与后端的UserController进程交互来完成。

​		在用户登录之后，会启动HomeworkProcess，该进程包含与后端HomeworkController交互获取与该登录用户相关的作业列表信息，同时此进程负责作业详情的查询以及返回作业编辑器界面的数据。

​		在编辑作业的过程中（包含学生写作业和老师修改作业内容），独立线程HomeworkCache会处理作业的缓存及与云端同步备份的过程。

​		管理课程的进程通过CourseBoard与用户交互，再将用户修改的信息传递给后端服务器的CourseController进行读写操作。

​		私信功能则由Message进程通过MessageBoard与用户交互后，将信息发送到后端服务器的MessageController上处理，从而完成交互过程。



## 5. 部署视图

<img src="软件架构文档.assets/deployment_view.png" alt="deployment_view" style="zoom:67%;" />

<center>图5.1 部署视图</center>



​		客户端运行在PC浏览器上。服务器上部署了APIServer、UserServer、HomeworkServer、DiscussionServer、UserDatabase、HomeworkDatabase、DiscussionDatabase。客户端与服务端通过互联网连接，服务端内部的各服务之间通过本地网络通信。

### 5.1 在物理架构中具有重要意义的组件

#### 5.1.1 UserServer

​		负责用户以及课程部分的业务逻辑，负责管理用户个人信息以及课程信息

#### 5.1.2 UserDatabase

​		存储与用户以及课程相关的数据，包括用户个人信息以及课程信息

#### 5.1.3 HomeworkServer

​		负责作业部分的业务逻辑，包括作业内容的存储、作业答案的存储以及教师对于作业的批阅信息的存储

#### 5.1.4 HomeworkDatabase

​		负责存储作业的具体内容、作业答案以及教师对于作业答案的批阅信息

#### 5.1.5 DiscussionServer

​		负责论坛讨论以及实施私信交流的业务逻辑

#### 5.1.6 DiscussionDatabase

​		负责存储论坛讨论的具体记录以及私信交流的具体记录



## 6. 实现视图



<img src="软件架构文档.assets/implementation_view-1604837447019.png" alt="implementation_view" style="zoom:67%;" />

<center>图6.1 实现视图<center/>

​		如图所示是本项目的实现视图。运行在客户PC浏览器的客户端通过Restful API向本项目的后端服务器发送请求。在后端服务器中运行的请求拦截进程会拦截来自客户端的请求，解析该请求，并将该请求分发给运行在后端服务器的某个微服务。本项目目前计划实现五大服务：User Service, Class Service, Discussion Service, Answer Service与Homework Service，分别处理关于用户登录注册、班级管理、在线讨论、答案管理以及作业管理这些方面的业务逻辑以及对应的与数据库交互的部分。



## 7. 页面视图



<img src="软件架构文档.assets/页面视图.png" alt="页面视图" style="zoom:67%;" />

<center>图7.1 页面视图<center/>
​		如图所示是本项目浏览器端的页面视图，详细展示了各个页面之间的关系。

## 8.GOF设计模式

### 8.1 作业发布

![ReleaseHomework](软件架构文档.assets/ReleaseHomework.png)

我们认为作业发布中用到了两种设计模式：Prototype和Factory Method模式

- 在发布作业时，对于teacher，releasedate，deadline等属性，可以通过模板自动生成，避免重复操作。

- 在添加题目时，我们提供了三个类型：选择题，填空题，作文题，可以选择三种类型生成对应模板。

  ### 8.2 SSO单点登录

  ![img](软件架构文档.assets/`%5H{%9%OLD{8@FNKQV{TAW.png)

对于SSO单点登录服务器，我们使用的是单例模式，在整个系统中仅存在一个。



